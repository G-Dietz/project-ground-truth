<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Ground Truth | Live Telemetry</title>

    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Leaflet CSS & JS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <!-- Prop-types (Required dependency for Recharts UMD) -->
    <script src="https://unpkg.com/prop-types/prop-types.min.js"></script>

    <!-- Recharts (Visualization) - Using v2.5.0 which is stable for UMD usage -->
    <script src="https://unpkg.com/recharts@2.5.0/umd/Recharts.js"></script>

    <style>
        body {
            background-color: #0f172a;
            color: #e2e8f0;
            font-family: 'Courier New', monospace;
        }

        .glass-panel {
            background: rgba(30, 41, 59, 0.85);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(148, 163, 184, 0.1);
        }

        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: #0f172a;
        }

        ::-webkit-scrollbar-thumb {
            background: #3b82f6;
            border-radius: 3px;
        }

        .leaflet-popup-content-wrapper {
            background: #1e293b;
            color: #fff;
            border: 1px solid #3b82f6;
        }

        .leaflet-popup-tip {
            background: #3b82f6;
        }
    </style>
</head>

<body class="h-screen w-screen overflow-hidden">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        const { BarChart, Bar, XAxis, YAxis, Tooltip, ResponsiveContainer, Cell } = Recharts;

        // DATA INJECTED FROM YOUR JSON FILE
        const MISSION_DATA = [
            {
                "id": 1,
                "name": "Walanae Depression",
                "coordinates": [-4.39, 120.05],
                "country": "ID",
                "date": "2026-08-15",
                "economics": { "inflation": 3.5, "gdp_growth": 5.0, "gini": 37.9 },
                "environment": { "biodiversity_index": 115.12, "geological_age_mya": 0.2 },
                "field_notes": "Lithic tools found dated to >100kya. Pre-sapiens crossing of Wallace Line."
            },
            {
                "id": 2,
                "name": "Hamelin Pool",
                "coordinates": [-26.4, 114.16],
                "country": "AU",
                "date": "2026-09-20",
                "economics": { "inflation": 4.1, "gdp_growth": 2.1, "gini": 34.3 },
                "environment": { "biodiversity_index": 70.67, "geological_age_mya": 3500 },
                "field_notes": "Living stromatolites. Hyper-saline environment preserving Precambrian conditions."
            },
            {
                "id": 3,
                "name": "Tarkine Rainforest",
                "coordinates": [-41.45, 145.15],
                "country": "AU",
                "date": "2027-01-25",
                "economics": { "inflation": 4.1, "gdp_growth": 2.1, "gini": 34.3 },
                "environment": { "biodiversity_index": 53.94, "geological_age_mya": 60 },
                "field_notes": "Cool temperate rainforest. Direct lineage to Gondwana supercontinent flora."
            },
            {
                "id": 4,
                "name": "Paleorrota",
                "coordinates": [-29.68, -53.8],
                "country": "BR",
                "date": "2027-04-10",
                "economics": { "inflation": 4.5, "gdp_growth": 2.9, "gini": 48.9 },
                "environment": { "biodiversity_index": 67.02, "geological_age_mya": 233 },
                "field_notes": "Triassic red beds. Excavation sites visible from roadside. Rise of Archosaurs."
            },
            {
                "id": 5,
                "name": "Jalapao",
                "coordinates": [-10.56, -46.87],
                "country": "BR",
                "date": "2027-05-02",
                "economics": { "inflation": 4.5, "gdp_growth": 2.9, "gini": 48.9 },
                "environment": { "biodiversity_index": 88.27, "geological_age_mya": 0 },
                "field_notes": "Fervedouros springs. High-pressure aquifer resurgences creating non-Newtonian fluid dynamics."
            },
            {
                "id": 6,
                "name": "Cuatro Cienegas",
                "coordinates": [26.98, -102.08],
                "country": "MX",
                "date": "2027-07-15",
                "economics": { "inflation": 4.4, "gdp_growth": 3.2, "gini": 45.4 },
                "environment": { "biodiversity_index": 70.02, "geological_age_mya": 3000 },
                "field_notes": "Oasis in Chihuahuan Desert. Marine origins. Evolutionary time capsule."
            },
            {
                "id": 7,
                "name": "Vredefort Dome",
                "coordinates": [-27.01, 27.45],
                "country": "ZA",
                "date": "2027-12-20",
                "economics": { "inflation": 5.3, "gdp_growth": 0.9, "gini": 63.0 },
                "environment": { "biodiversity_index": 69.99, "geological_age_mya": 2020 },
                "field_notes": "Largest impact crater on Earth. 300km diameter. Pseudotachylite veins visible."
            }
        ];

        const Dashboard = () => {
            const [selectedPoint, setSelectedPoint] = useState(MISSION_DATA[0]);
            const [mapInstance, setMapInstance] = useState(null);

            useEffect(() => {
                if (!document.getElementById('map')) return;

                // Initialize Map
                const map = L.map('map', {
                    zoomControl: false,
                    center: [-10, 20],
                    zoom: 2
                });

                L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
                    attribution: '&copy; OpenStreetMap &copy; CARTO',
                    maxZoom: 19
                }).addTo(map);

                // Draw Path
                const latlngs = MISSION_DATA.map(p => p.coordinates);
                L.polyline(latlngs, { color: '#3b82f6', weight: 1, dashArray: '5, 10', opacity: 0.5 }).addTo(map);

                // Add Markers
                MISSION_DATA.forEach(point => {
                    const marker = L.circleMarker(point.coordinates, {
                        color: '#3b82f6',
                        fillColor: '#60a5fa',
                        fillOpacity: 0.8,
                        radius: 8
                    }).addTo(map);

                    marker.on('click', () => {
                        setSelectedPoint(point);
                        map.flyTo(point.coordinates, 6, { duration: 1.5 });
                    });

                    // Add tooltip
                    marker.bindTooltip(point.name, { permanent: false, direction: 'top', className: 'bg-slate-800 text-white border-0' });
                });

                setMapInstance(map);
                return () => map.remove();
            }, []);

            // Prepare chart data for the bottom panel
            const chartData = [
                { name: 'Inflation', value: selectedPoint.economics.inflation, fullMark: 10, fill: '#f87171' },
                { name: 'GDP Growth', value: selectedPoint.economics.gdp_growth, fullMark: 10, fill: '#4ade80' },
                { name: 'Gini Coeff', value: selectedPoint.economics.gini, fullMark: 100, fill: '#fbbf24' },
            ];

            // Log Scale for Geological Age Bar
            const getAgeWidth = (age) => {
                if (age <= 0) return '0%';
                const logAge = Math.log10(age + 1);
                const logMax = Math.log10(4000); // 4 Billion Years
                return `${(logAge / logMax) * 100}%`;
            }

            return (
                <div className="flex h-full font-mono">
                    {/* LEFT SIDEBAR */}
                    <div className="w-80 glass-panel flex flex-col border-r border-slate-700 z-20 shadow-2xl">
                        <div className="p-6 border-b border-slate-700">
                            <div className="text-[10px] text-blue-500 mb-1">MISSION DASHBOARD</div>
                            <h1 className="text-xl font-bold text-white tracking-widest">PROJECT<br />GROUND TRUTH</h1>
                            <div className="mt-4 flex items-center space-x-2 bg-blue-900/20 p-2 rounded border border-blue-500/30">
                                <div className="h-2 w-2 rounded-full bg-green-500 animate-pulse"></div>
                                <span className="text-xs text-green-400">DATA STREAM ACTIVE</span>
                            </div>
                        </div>

                        <div className="flex-1 overflow-y-auto p-2 space-y-1">
                            {MISSION_DATA.map(point => (
                                <div
                                    key={point.id}
                                    onClick={() => {
                                        setSelectedPoint(point);
                                        if (mapInstance) mapInstance.flyTo(point.coordinates, 6);
                                    }}
                                    className={`p-3 rounded cursor-pointer transition-all border-l-2 ${selectedPoint.id === point.id ? 'bg-slate-700/50 border-blue-500 text-white' : 'border-transparent text-slate-400 hover:bg-slate-800 hover:text-slate-200'}`}
                                >
                                    <div className="flex justify-between items-center mb-1">
                                        <span className="text-xs font-bold uppercase">{point.country}</span>
                                        <span className="text-[10px] font-mono opacity-50">{point.date}</span>
                                    </div>
                                    <div className="text-sm font-semibold truncate">{point.name}</div>
                                </div>
                            ))}
                        </div>
                    </div>

                    {/* MAIN MAP AREA */}
                    <div className="flex-1 relative">
                        <div id="map" className="h-full w-full bg-slate-900"></div>

                        {/* DATA OVERLAY PANEL */}
                        <div className="absolute bottom-0 left-0 right-0 glass-panel border-t border-slate-700 z-[1000] p-6 transition-all duration-500">
                            <div className="flex gap-8 h-48">

                                {/* COL 1: INFO & NOTES */}
                                <div className="w-1/3 border-r border-slate-700 pr-6 flex flex-col">
                                    <h2 className="text-2xl font-bold text-white mb-1">{selectedPoint.name}</h2>
                                    <div className="text-xs text-blue-400 mb-3 font-mono">
                                        LAT: {selectedPoint.coordinates[0]} | LON: {selectedPoint.coordinates[1]}
                                    </div>
                                    <div className="flex-1 bg-slate-800/50 p-3 rounded border border-slate-600/30 overflow-y-auto">
                                        <p className="text-xs text-slate-300 leading-relaxed font-sans">
                                            <span className="text-blue-400 font-bold block mb-1">FIELD NOTES:</span>
                                            {selectedPoint.field_notes}
                                        </p>
                                    </div>
                                </div>

                                {/* COL 2: ECONOMICS */}
                                <div className="w-1/3 border-r border-slate-700 pr-6">
                                    <h3 className="text-xs font-bold text-slate-400 uppercase mb-2 tracking-wider">Economic Indicators</h3>
                                    <div className="h-full w-full">
                                        <ResponsiveContainer width="100%" height="100%">
                                            <BarChart data={chartData} layout="vertical" margin={{ top: 5, right: 30, left: 40, bottom: 5 }}>
                                                <XAxis type="number" hide />
                                                <YAxis dataKey="name" type="category" width={80} tick={{ fill: '#94a3b8', fontSize: 10 }} />
                                                <Tooltip
                                                    contentStyle={{ backgroundColor: '#1e293b', borderColor: '#334155', color: '#fff' }}
                                                    itemStyle={{ color: '#fff' }}
                                                />
                                                <Bar dataKey="value" barSize={15} radius={[0, 4, 4, 0]}>
                                                    {chartData.map((entry, index) => (
                                                        <Cell key={`cell-${index}`} fill={entry.fill} />
                                                    ))}
                                                </Bar>
                                            </BarChart>
                                        </ResponsiveContainer>
                                    </div>
                                </div>

                                {/* COL 3: DEEP TIME & BIO */}
                                <div className="w-1/3 flex flex-col justify-between">
                                    <div>
                                        <h3 className="text-xs font-bold text-slate-400 uppercase mb-2 tracking-wider">Geological Age</h3>
                                        <div className="flex justify-between text-[10px] text-slate-500 mb-1">
                                            <span>Present</span>
                                            <span>4 Billion Years</span>
                                        </div>
                                        <div className="w-full bg-slate-800 h-3 rounded-sm overflow-hidden relative border border-slate-700">
                                            <div
                                                className="absolute left-0 top-0 bottom-0 bg-gradient-to-r from-blue-500 to-amber-500 transition-all duration-1000 ease-out"
                                                style={{ width: getAgeWidth(selectedPoint.environment.geological_age_mya) }}
                                            ></div>
                                        </div>
                                        <div className="text-right text-xs text-amber-400 mt-1 font-bold">
                                            {selectedPoint.environment.geological_age_mya > 0 ? `${selectedPoint.environment.geological_age_mya} MYA` : "Modern Era"}
                                        </div>
                                    </div>

                                    <div className="mt-2">
                                        <h3 className="text-xs font-bold text-slate-400 uppercase mb-1 tracking-wider">Biodiversity Index</h3>
                                        <div className="flex items-end">
                                            <span className="text-4xl font-bold text-purple-400">{Math.round(selectedPoint.environment.biodiversity_index)}</span>
                                            <span className="text-xs text-slate-500 mb-2 ml-2">/ 100 (Shannon Estimated)</span>
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<Dashboard />);
    </script>
</body>

</html>